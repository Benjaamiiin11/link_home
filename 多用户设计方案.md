# 多用户支持设计方案

## 当前架构分析
- **存储方式**: localStorage（浏览器本地存储）
- **数据范围**: 单用户，所有数据存储在同一个浏览器中
- **同步**: 无，数据仅本地存储

## 方案一：前端多用户切换（简单方案）

### 特点
- ✅ 无需后端服务
- ✅ 快速实现
- ✅ 数据完全本地化，隐私性好
- ❌ 不支持跨设备同步
- ❌ 数据仅存储在单个浏览器

### 实现思路
1. **用户管理**
   - 用户列表存储在 `localStorage` 中
   - 每个用户有独立的用户ID和名称
   - 当前活跃用户存储在 `currentUserId`

2. **数据隔离**
   - 所有数据以 `user_${userId}_` 为前缀存储
   - 例如：`user_001_linksData`, `user_001_favoriteLinks`
   - 切换用户时，加载对应前缀的数据

3. **用户界面**
   - 顶部添加用户切换按钮
   - 用户管理模态框（添加/删除/切换用户）
   - 显示当前用户信息

### 数据结构
```javascript
// 用户列表
users: [
  { id: 'user_001', name: '张三', avatar: '', createdAt: '2024-01-01' },
  { id: 'user_002', name: '李四', avatar: '', createdAt: '2024-01-02' }
]

// 当前用户
currentUserId: 'user_001'

// 数据存储键名
user_001_linksData
user_001_linksOrder
user_001_customCategories
user_001_favoriteLinks
user_001_accessHistory
user_001_allTags
user_001_categoryFolders
```

---

## 方案二：完整后端服务（推荐用于生产环境）

### 特点
- ✅ 支持跨设备同步
- ✅ 数据云端备份
- ✅ 支持共享功能
- ✅ 更好的用户体验
- ❌ 需要后端开发
- ❌ 需要服务器和数据库

### 技术栈建议
- **前端**: 当前技术栈（HTML/CSS/JS）
- **后端**: Node.js + Express 或 Python + Flask/FastAPI
- **数据库**: PostgreSQL / MongoDB / MySQL
- **认证**: JWT Token
- **API**: RESTful API

### 功能模块

#### 1. 用户认证
- 注册/登录
- 密码加密（bcrypt）
- JWT Token 管理
- 记住登录状态

#### 2. 数据同步
- 实时同步（WebSocket）或定时同步（轮询）
- 冲突解决策略
- 离线支持（IndexedDB + 同步队列）

#### 3. 共享功能（可选）
- 链接分享（公开/私有/密码保护）
- 团队协作（共享分类/链接）
- 权限管理（只读/编辑/管理员）

#### 4. API 设计
```
POST   /api/auth/register      # 注册
POST   /api/auth/login         # 登录
POST   /api/auth/logout        # 登出
GET    /api/user/profile       # 获取用户信息

GET    /api/links              # 获取链接列表
POST   /api/links              # 创建链接
PUT    /api/links/:id          # 更新链接
DELETE /api/links/:id          # 删除链接

GET    /api/categories         # 获取分类
POST   /api/categories         # 创建分类
PUT    /api/categories/:id    # 更新分类
DELETE /api/categories/:id    # 删除分类

GET    /api/sync               # 同步数据
POST   /api/sync               # 上传数据
```

---

## 方案三：混合方案（渐进式）

### 阶段一：前端多用户切换
- 实现方案一，快速支持多用户
- 用户数据本地隔离

### 阶段二：添加导出/导入
- 支持导出用户数据为JSON
- 支持从JSON导入数据
- 方便用户备份和迁移

### 阶段三：可选云端同步
- 添加"同步到云端"选项
- 使用第三方服务（如Firebase）或自建后端
- 用户可选择是否启用同步

---

## 推荐实施路径

### 第一步：实现前端多用户切换（方案一）
**原因**：
- 快速满足多用户需求
- 无需额外基础设施
- 保持数据隐私性

**实现内容**：
1. 用户管理界面
2. 数据隔离机制
3. 用户切换功能
4. 用户数据迁移工具

### 第二步：根据需求决定是否升级
**如果需要跨设备同步** → 实施方案二
**如果仅需本地多用户** → 方案一已足够

---

## 实施优先级

### 高优先级
1. ✅ 用户管理界面（添加/删除/切换用户）
2. ✅ 数据隔离（每个用户独立存储）
3. ✅ 用户切换功能
4. ✅ 当前用户显示

### 中优先级
5. 用户头像/昵称设置
6. 用户数据导出/导入
7. 用户数据统计

### 低优先级（需要后端）
8. 云端同步
9. 共享功能
10. 团队协作

---

## 注意事项

1. **数据迁移**
   - 现有用户数据需要迁移到新用户下
   - 提供数据迁移工具

2. **隐私保护**
   - 用户数据完全隔离
   - 不共享任何信息

3. **性能考虑**
   - localStorage 有大小限制（通常5-10MB）
   - 大量用户数据可能需要 IndexedDB

4. **用户体验**
   - 用户切换要快速流畅
   - 提供清晰的用户标识
   - 记住最后使用的用户

